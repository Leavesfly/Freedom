# 快速入门

<cite>
**本文档中引用的文件**  
- [pom.xml](file://pom.xml)
- [FreedomServer.java](file://src/main/java/alchemystar/freedom/engine/server/FreedomServer.java)
- [Database.java](file://src/main/java/alchemystar/freedom/engine/Database.java)
- [SystemConfig.java](file://src/main/java/alchemystar/freedom/config/SystemConfig.java)
- [SocketConfig.java](file://src/main/java/alchemystar/freedom/config/SocketConfig.java)
- [FrontendAuthenticator.java](file://src/main/java/alchemystar/freedom/engine/net/handler/frontend/FrontendAuthenticator.java)
- [README.md](file://README.md)
</cite>

## 目录
1. [简介](#简介)
2. [构建项目](#构建项目)
3. [启动数据库](#启动数据库)
4. [默认配置说明](#默认配置说明)
5. [连接到数据库](#连接到数据库)
6. [执行第一个SQL语句](#执行第一个sql语句)
7. [关键日志输出解析](#关键日志输出解析)
8. [常见启动问题排查](#常见启动问题排查)
9. [总结](#总结)

## 简介
本指南旨在帮助开发者从零开始构建、启动并连接到Freedom数据库。Freedom是一个基于MySQL协议实现的轻量级SQL执行引擎，支持基本的数据库操作。本指南将详细介绍Maven构建命令、启动流程、默认配置、连接方式以及常见问题的解决方法，确保即使没有数据库内核经验的开发者也能顺利上手。

## 构建项目
使用Maven构建工具来编译和打包Freedom项目。确保系统中已安装Maven和Java 8或更高版本。

### Maven构建命令
在项目根目录下执行以下命令进行构建：

```bash
mvn clean compile
```

该命令将清理旧的编译结果并重新编译所有Java源文件。项目依赖已在`pom.xml`中定义，Maven会自动下载所需的库文件。

**Section sources**
- [pom.xml](file://pom.xml#L0-L202)

## 启动数据库
Freedom数据库的启动入口是`FreedomServer.java`类。该类继承自`Thread`，通过`main`方法启动服务器实例。

### 启动流程解析
1. 创建`FreedomServer`实例
2. 调用`start()`方法启动线程
3. 在`run()`方法中调用`startServer()`开始监听端口
4. 使用Netty框架创建服务器引导程序
5. 配置事件循环组和通道处理器
6. 绑定到指定端口并开始监听连接

```java
public static void main(String[] args) {
    FreedomServer server = new FreedomServer();
    try {
        server.start();
        while (true) {
            try {
                Thread.sleep(1000 * 300);
            }catch (Exception e){
                // just ignore it
            }
        }
    } catch (Exception e) {
        e.printStackTrace();
    }
}
```

**Section sources**
- [FreedomServer.java](file://src/main/java/alchemystar/freedom/engine/server/FreedomServer.java#L21-L75)

## 默认配置说明
Freedom数据库提供了一系列默认配置，包括端口、用户名、密码等。

### 核心配置参数
| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| 服务器端口 | 8090 | 数据库监听的TCP端口 |
| 用户名 | pay | 默认登录用户名 |
| 密码 | MiraCle | 默认登录密码 |
| 字符集 | gbk | 默认字符编码 |
| 页面大小 | 4096 | B+树存储页大小（字节） |
| 空闲超时 | 36小时 | 连接空闲超时时间（秒） |

这些配置主要在`Database.java`和`SystemConfig.java`中定义。`Database`类使用单例模式管理全局配置。

```java
private int serverPort = 8090;
private String userName = "pay";
private String passWd = "MiraCle";
```

**Section sources**
- [Database.java](file://src/main/java/alchemystar/freedom/engine/Database.java#L0-L78)
- [SystemConfig.java](file://src/main/java/alchemystar/freedom/config/SystemConfig.java#L0-L37)

## 连接到数据库
使用标准的MySQL客户端可以连接到Freedom数据库，因为它实现了MySQL协议。

### 使用MySQL客户端连接
1. 安装MySQL客户端（如果尚未安装）
2. 使用以下命令连接：

```bash
mysql -h 127.0.0.1 -P 8090 -u pay -p
```

系统会提示输入密码，输入`MiraCle`即可成功连接。

### 连接认证流程
1. 客户端发送连接请求
2. 服务器返回握手包（HandshakePacket）
3. 客户端发送认证包（AuthPacket）
4. 服务器验证用户名和密码
5. 认证成功后返回OK包，进入命令处理状态

认证逻辑在`FrontendAuthenticator.java`中实现，使用MySQL的scramble411算法进行密码验证。

**Section sources**
- [FrontendAuthenticator.java](file://src/main/java/alchemystar/freedom/engine/net/handler/frontend/FrontendAuthenticator.java#L0-L173)
- [Database.java](file://src/main/java/alchemystar/freedom/engine/Database.java#L0-L78)

## 执行第一个SQL语句
连接成功后，可以执行SQL语句进行测试。

### 执行SELECT 1示例
```sql
mysql> SELECT 1;
+---+
| 1 |
+---+
| 1 |
+---+
1 row in set (0.00 sec)
```

### SQL执行流程
1. 客户端发送查询命令包
2. 服务器解析SQL语句
3. 执行查询逻辑
4. 构造结果集包
5. 返回结果给客户端

服务器通过`FrontendCommandHandler`处理各种SQL命令，包括SELECT、INSERT、UPDATE等。

**Section sources**
- [FrontendCommandHandler.java](file://src/main/java/alchemystar/freedom/engine/net/handler/frontend/FrontendCommandHandler.java)
- [ServerParse.java](file://src/main/java/alchemystar/freedom/engine/parser/ServerParse.java)

## 关键日志输出解析
启动过程中会产生重要的日志信息，帮助开发者了解服务器状态。

### 主要日志信息
- `Start Freedom`: 服务器开始启动
- `监听失败`: 端口绑定失败，可能端口被占用
- 认证相关日志: 显示连接认证过程
- SQL执行日志: 记录SQL语句的执行情况

日志使用SLF4J框架输出，配置在`logback-classic`中。默认情况下，日志会输出到控制台。

```java
logger.info("Start Freedom");
```

**Section sources**
- [FreedomServer.java](file://src/main/java/alchemystar/freedom/engine/server/FreedomServer.java#L21-L75)
- [pom.xml](file://pom.xml#L0-L202)

## 常见启动问题排查
在启动过程中可能会遇到一些常见问题，以下是解决方案。

### 端口占用问题
**现象**: 启动时出现"监听失败"错误  
**原因**: 8090端口已被其他进程占用  
**解决方案**:  
1. 查找占用端口的进程：`lsof -i :8090`
2. 终止占用进程或修改配置端口
3. 在`Database.java`中修改`serverPort`值

### 依赖缺失问题
**现象**: 编译时出现类找不到错误  
**原因**: Maven依赖未正确下载  
**解决方案**:  
1. 清理并重新下载依赖：`mvn clean dependency:resolve`
2. 检查网络连接和Maven仓库配置
3. 确保`pom.xml`中的依赖版本正确

### 认证失败问题
**现象**: 连接时提示"Access denied"  
**原因**: 用户名或密码错误  
**解决方案**:  
1. 确认使用默认用户名`pay`和密码`MiraCle`
2. 检查密码大小写敏感性
3. 查看`FrontendAuthenticator.java`中的认证逻辑

**Section sources**
- [FreedomServer.java](file://src/main/java/alchemystar/freedom/engine/server/FreedomServer.java#L21-L75)
- [FrontendAuthenticator.java](file://src/main/java/alchemystar/freedom/engine/net/handler/frontend/FrontendAuthenticator.java#L0-L173)
- [pom.xml](file://pom.xml#L0-L202)

## 总结
本指南详细介绍了如何从零开始构建、启动并连接到Freedom数据库。通过Maven构建项目，使用`FreedomServer.java`作为启动入口，连接到默认配置的8090端口，使用标准MySQL客户端进行交互。我们还解析了关键日志输出，并提供了常见问题的解决方案。Freedom作为一个学习型数据库项目，为理解数据库底层原理提供了良好的实践平台。

**Section sources**
- [README.md](file://README.md#L0-L133)
- [pom.xml](file://pom.xml#L0-L202)
- [FreedomServer.java](file://src/main/java/alchemystar/freedom/engine/server/FreedomServer.java#L21-L75)